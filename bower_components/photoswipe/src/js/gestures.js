var MIN_SWIPE_DISTANCE=30,DIRECTION_CHECK_OFFSET=10,_gestureStartTime,_gestureCheckSpeedTime,p={},p2={},delta={},_currPoint={},_startPoint={},_currPointers=[],_startMainScrollPos={},_releaseAnimData,_posPoints=[],_tempPoint={},_isZoomingIn,_verticalDragInitiated,_oldAndroidTouchEndTimeout,_currZoomedItemIndex=0,_centerPoint=_getEmptyPoint(),_lastReleaseTime=0,_isDragging,_isMultitouch,_zoomStarted,_moved,_dragAnimFrame,_mainScrollShifted,_currentPoints,_isZooming,_currPointsDistance,_startPointsDistance,_currPanBounds,_mainScrollPos=_getEmptyPoint(),_currZoomElementStyle,_mainScrollAnimating,_midZoomPoint=_getEmptyPoint(),_currCenterPoint=_getEmptyPoint(),_direction,_isFirstMove,_opacityChanged,_bgOpacity,_wasOverInitialZoom,_isEqualPoints=function(e,t){return e.x===t.x&&e.y===t.y},_isNearbyPoints=function(e,t){return Math.abs(e.x-t.x)<DOUBLE_TAP_RADIUS&&Math.abs(e.y-t.y)<DOUBLE_TAP_RADIUS},_calculatePointsDistance=function(e,t){return _tempPoint.x=Math.abs(e.x-t.x),_tempPoint.y=Math.abs(e.y-t.y),Math.sqrt(_tempPoint.x*_tempPoint.x+_tempPoint.y*_tempPoint.y)},_stopDragUpdateLoop=function(){_dragAnimFrame&&(_cancelAF(_dragAnimFrame),_dragAnimFrame=null)},_dragUpdateLoop=function(){_isDragging&&(_dragAnimFrame=_requestAF(_dragUpdateLoop),_renderMovement())},_canPan=function(){return!("fit"===_options.scaleMode&&_currZoomLevel===self.currItem.initialZoomLevel)},_closestElement=function(e,t){return e?e.className&&e.className.indexOf("pswp__scroll-wrap")>-1?!1:t(e)?e:_closestElement(e.parentNode,t):!1},_preventObj={},_preventDefaultEventBehaviour=function(e,t){return _preventObj.prevent=!_closestElement(e.target,_options.isClickableElement),_shout("preventDragEvent",e,t,_preventObj),_preventObj.prevent},_convertTouchToPoint=function(e,t){return t.x=e.pageX,t.y=e.pageY,t.id=e.identifier,t},_findCenterOfPoints=function(e,t,n){n.x=.5*(e.x+t.x),n.y=.5*(e.y+t.y)},_pushPosPoint=function(e,t,n){if(e-_gestureCheckSpeedTime>50){var o=_posPoints.length>2?_posPoints.shift():{};o.x=t,o.y=n,_posPoints.push(o),_gestureCheckSpeedTime=e}},_calculateVerticalDragOpacityRatio=function(){var e=_panOffset.y-self.currItem.initialPosition.y;return 1-Math.abs(e/(_viewportSize.y/2))},_ePoint1={},_ePoint2={},_tempPointsArr=[],_tempCounter,_getTouchPoints=function(e){for(;_tempPointsArr.length>0;)_tempPointsArr.pop();return _pointerEventEnabled?(_tempCounter=0,_currPointers.forEach(function(e){0===_tempCounter?_tempPointsArr[0]=e:1===_tempCounter&&(_tempPointsArr[1]=e),_tempCounter++})):e.type.indexOf("touch")>-1?e.touches&&e.touches.length>0&&(_tempPointsArr[0]=_convertTouchToPoint(e.touches[0],_ePoint1),e.touches.length>1&&(_tempPointsArr[1]=_convertTouchToPoint(e.touches[1],_ePoint2))):(_ePoint1.x=e.pageX,_ePoint1.y=e.pageY,_ePoint1.id="",_tempPointsArr[0]=_ePoint1),_tempPointsArr},_panOrMoveMainScroll=function(e,t){var n,o,i,r,a=0,s=_panOffset[e]+t[e],_=t[e]>0,l=_mainScrollPos.x+t.x,c=_mainScrollPos.x-_startMainScrollPos.x;return n=s>_currPanBounds.min[e]||s<_currPanBounds.max[e]?_options.panEndFriction:1,s=_panOffset[e]+t[e]*n,!_options.allowPanToNext&&_currZoomLevel!==self.currItem.initialZoomLevel||(_currZoomElementStyle?"h"!==_direction||"x"!==e||_zoomStarted||(_?(s>_currPanBounds.min[e]&&(n=_options.panEndFriction,a=_currPanBounds.min[e]-s,o=_currPanBounds.min[e]-_startPanOffset[e]),(0>=o||0>c)&&_getNumItems()>1?(r=l,0>c&&l>_startMainScrollPos.x&&(r=_startMainScrollPos.x)):_currPanBounds.min.x!==_currPanBounds.max.x&&(i=s)):(s<_currPanBounds.max[e]&&(n=_options.panEndFriction,a=s-_currPanBounds.max[e],o=_startPanOffset[e]-_currPanBounds.max[e]),(0>=o||c>0)&&_getNumItems()>1?(r=l,c>0&&l<_startMainScrollPos.x&&(r=_startMainScrollPos.x)):_currPanBounds.min.x!==_currPanBounds.max.x&&(i=s))):r=l,"x"!==e)?void(_mainScrollAnimating||_mainScrollShifted||_currZoomLevel>self.currItem.fitRatio&&(_panOffset[e]+=t[e]*n)):(void 0!==r&&(_moveMainScroll(r,!0),_mainScrollShifted=r===_startMainScrollPos.x?!1:!0),_currPanBounds.min.x!==_currPanBounds.max.x&&(void 0!==i?_panOffset.x=i:_mainScrollShifted||(_panOffset.x+=t.x*n)),void 0!==r)},_onDragStart=function(e){if(!("mousedown"===e.type&&e.button>0)){if(_initialZoomRunning)return void e.preventDefault();if(!_oldAndroidTouchEndTimeout||"mousedown"!==e.type){if(_preventDefaultEventBehaviour(e,!0)&&e.preventDefault(),_shout("pointerDown"),_pointerEventEnabled){var t=framework.arraySearch(_currPointers,e.pointerId,"id");0>t&&(t=_currPointers.length),_currPointers[t]={x:e.pageX,y:e.pageY,id:e.pointerId}}var n=_getTouchPoints(e),o=n.length;_currentPoints=null,_stopAllAnimations(),_isDragging&&1!==o||(_isDragging=_isFirstMove=!0,framework.bind(window,_upMoveEvents,self),_isZoomingIn=_wasOverInitialZoom=_opacityChanged=_verticalDragInitiated=_mainScrollShifted=_moved=_isMultitouch=_zoomStarted=!1,_direction=null,_shout("firstTouchStart",n),_equalizePoints(_startPanOffset,_panOffset),_currPanDist.x=_currPanDist.y=0,_equalizePoints(_currPoint,n[0]),_equalizePoints(_startPoint,_currPoint),_startMainScrollPos.x=_slideSize.x*_currPositionIndex,_posPoints=[{x:_currPoint.x,y:_currPoint.y}],_gestureCheckSpeedTime=_gestureStartTime=_getCurrentTime(),_calculatePanBounds(_currZoomLevel,!0),_stopDragUpdateLoop(),_dragUpdateLoop()),!_isZooming&&o>1&&!_mainScrollAnimating&&!_mainScrollShifted&&(_startZoomLevel=_currZoomLevel,_zoomStarted=!1,_isZooming=_isMultitouch=!0,_currPanDist.y=_currPanDist.x=0,_equalizePoints(_startPanOffset,_panOffset),_equalizePoints(p,n[0]),_equalizePoints(p2,n[1]),_findCenterOfPoints(p,p2,_currCenterPoint),_midZoomPoint.x=Math.abs(_currCenterPoint.x)-_panOffset.x,_midZoomPoint.y=Math.abs(_currCenterPoint.y)-_panOffset.y,_currPointsDistance=_startPointsDistance=_calculatePointsDistance(p,p2))}}},_onDragMove=function(e){if(e.preventDefault(),_pointerEventEnabled){var t=framework.arraySearch(_currPointers,e.pointerId,"id");if(t>-1){var n=_currPointers[t];n.x=e.pageX,n.y=e.pageY}}if(_isDragging){var o=_getTouchPoints(e);if(_direction||_moved||_isZooming)_currentPoints=o;else if(_mainScrollPos.x!==_slideSize.x*_currPositionIndex)_direction="h";else{var i=Math.abs(o[0].x-_currPoint.x)-Math.abs(o[0].y-_currPoint.y);Math.abs(i)>=DIRECTION_CHECK_OFFSET&&(_direction=i>0?"h":"v",_currentPoints=o)}}},_renderMovement=function(){if(_currentPoints){var e=_currentPoints.length;if(0!==e)if(_equalizePoints(p,_currentPoints[0]),delta.x=p.x-_currPoint.x,delta.y=p.y-_currPoint.y,_isZooming&&e>1){if(_currPoint.x=p.x,_currPoint.y=p.y,!delta.x&&!delta.y&&_isEqualPoints(_currentPoints[1],p2))return;_equalizePoints(p2,_currentPoints[1]),_zoomStarted||(_zoomStarted=!0,_shout("zoomGestureStarted"));var t=_calculatePointsDistance(p,p2),n=_calculateZoomLevel(t);n>self.currItem.initialZoomLevel+self.currItem.initialZoomLevel/15&&(_wasOverInitialZoom=!0);var o=1,i=_getMinZoomLevel(),r=_getMaxZoomLevel();if(i>n)if(_options.pinchToClose&&!_wasOverInitialZoom&&_startZoomLevel<=self.currItem.initialZoomLevel){var a=i-n,s=1-a/(i/1.2);_applyBgOpacity(s),_shout("onPinchClose",s),_opacityChanged=!0}else o=(i-n)/i,o>1&&(o=1),n=i-o*(i/3);else n>r&&(o=(n-r)/(6*i),o>1&&(o=1),n=r+o*i);0>o&&(o=0),_currPointsDistance=t,_findCenterOfPoints(p,p2,_centerPoint),_currPanDist.x+=_centerPoint.x-_currCenterPoint.x,_currPanDist.y+=_centerPoint.y-_currCenterPoint.y,_equalizePoints(_currCenterPoint,_centerPoint),_panOffset.x=_calculatePanOffset("x",n),_panOffset.y=_calculatePanOffset("y",n),_isZoomingIn=n>_currZoomLevel,_currZoomLevel=n,_applyCurrentZoomPan()}else{if(!_direction)return;if(_isFirstMove&&(_isFirstMove=!1,Math.abs(delta.x)>=DIRECTION_CHECK_OFFSET&&(delta.x-=_currentPoints[0].x-_startPoint.x),Math.abs(delta.y)>=DIRECTION_CHECK_OFFSET&&(delta.y-=_currentPoints[0].y-_startPoint.y)),_currPoint.x=p.x,_currPoint.y=p.y,0===delta.x&&0===delta.y)return;if("v"===_direction&&_options.closeOnVerticalDrag&&!_canPan()){_currPanDist.y+=delta.y,_panOffset.y+=delta.y;var _=_calculateVerticalDragOpacityRatio();return _verticalDragInitiated=!0,_shout("onVerticalDrag",_),_applyBgOpacity(_),void _applyCurrentZoomPan()}_pushPosPoint(_getCurrentTime(),p.x,p.y),_moved=!0,_currPanBounds=self.currItem.bounds;var l=_panOrMoveMainScroll("x",delta);l||(_panOrMoveMainScroll("y",delta),_roundPoint(_panOffset),_applyCurrentZoomPan())}}},_onDragRelease=function(e){if(_features.isOldAndroid){if(_oldAndroidTouchEndTimeout&&"mouseup"===e.type)return;e.type.indexOf("touch")>-1&&(clearTimeout(_oldAndroidTouchEndTimeout),_oldAndroidTouchEndTimeout=setTimeout(function(){_oldAndroidTouchEndTimeout=0},600))}_shout("pointerUp"),_preventDefaultEventBehaviour(e,!1)&&e.preventDefault();var t;if(_pointerEventEnabled){var n=framework.arraySearch(_currPointers,e.pointerId,"id");if(n>-1)if(t=_currPointers.splice(n,1)[0],navigator.pointerEnabled)t.type=e.pointerType||"mouse";else{var o={4:"mouse",2:"touch",3:"pen"};t.type=o[e.pointerType],t.type||(t.type=e.pointerType||"mouse")}}var i,r=_getTouchPoints(e),a=r.length;if("mouseup"===e.type&&(a=0),2===a)return _currentPoints=null,!0;1===a&&_equalizePoints(_startPoint,r[0]),0!==a||_direction||_mainScrollAnimating||(t||("mouseup"===e.type?t={x:e.pageX,y:e.pageY,type:"mouse"}:e.changedTouches&&e.changedTouches[0]&&(t={x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY,type:"touch"})),_shout("touchRelease",e,t));var s=-1;if(0===a&&(_isDragging=!1,framework.unbind(window,_upMoveEvents,self),_stopDragUpdateLoop(),_isZooming?s=0:-1!==_lastReleaseTime&&(s=_getCurrentTime()-_lastReleaseTime)),_lastReleaseTime=1===a?_getCurrentTime():-1,i=-1!==s&&150>s?"zoom":"swipe",_isZooming&&2>a&&(_isZooming=!1,1===a&&(i="zoomPointerUp"),_shout("zoomGestureEnded")),_currentPoints=null,_moved||_zoomStarted||_mainScrollAnimating||_verticalDragInitiated)if(_stopAllAnimations(),_releaseAnimData||(_releaseAnimData=_initDragReleaseAnimationData()),_releaseAnimData.calculateSwipeSpeed("x"),_verticalDragInitiated){var _=_calculateVerticalDragOpacityRatio();if(_<_options.verticalDragRange)self.close();else{var l=_panOffset.y,c=_bgOpacity;_animateProp("verticalDrag",0,1,300,framework.easing.cubic.out,function(e){_panOffset.y=(self.currItem.initialPosition.y-l)*e+l,_applyBgOpacity((1-c)*e+c),_applyCurrentZoomPan()}),_shout("onVerticalDrag",1)}}else{if((_mainScrollShifted||_mainScrollAnimating)&&0===a){var u=_finishSwipeMainScrollGesture(i,_releaseAnimData);if(u)return;i="zoomPointerUp"}if(!_mainScrollAnimating)return"swipe"!==i?void _completeZoomGesture():void(!_mainScrollShifted&&_currZoomLevel>self.currItem.fitRatio&&_completePanGesture(_releaseAnimData))}},_initDragReleaseAnimationData=function(){var e,t,n={lastFlickOffset:{},lastFlickDist:{},lastFlickSpeed:{},slowDownRatio:{},slowDownRatioReverse:{},speedDecelerationRatio:{},speedDecelerationRatioAbs:{},distanceOffset:{},backAnimDestination:{},backAnimStarted:{},calculateSwipeSpeed:function(o){_posPoints.length>1?(e=_getCurrentTime()-_gestureCheckSpeedTime+50,t=_posPoints[_posPoints.length-2][o]):(e=_getCurrentTime()-_gestureStartTime,t=_startPoint[o]),n.lastFlickOffset[o]=_currPoint[o]-t,n.lastFlickDist[o]=Math.abs(n.lastFlickOffset[o]),n.lastFlickDist[o]>20?n.lastFlickSpeed[o]=n.lastFlickOffset[o]/e:n.lastFlickSpeed[o]=0,Math.abs(n.lastFlickSpeed[o])<.1&&(n.lastFlickSpeed[o]=0),n.slowDownRatio[o]=.95,n.slowDownRatioReverse[o]=1-n.slowDownRatio[o],n.speedDecelerationRatio[o]=1},calculateOverBoundsAnimOffset:function(e,t){n.backAnimStarted[e]||(_panOffset[e]>_currPanBounds.min[e]?n.backAnimDestination[e]=_currPanBounds.min[e]:_panOffset[e]<_currPanBounds.max[e]&&(n.backAnimDestination[e]=_currPanBounds.max[e]),void 0!==n.backAnimDestination[e]&&(n.slowDownRatio[e]=.7,n.slowDownRatioReverse[e]=1-n.slowDownRatio[e],n.speedDecelerationRatioAbs[e]<.05&&(n.lastFlickSpeed[e]=0,n.backAnimStarted[e]=!0,_animateProp("bounceZoomPan"+e,_panOffset[e],n.backAnimDestination[e],t||300,framework.easing.sine.out,function(t){_panOffset[e]=t,_applyCurrentZoomPan()}))))},calculateAnimOffset:function(e){n.backAnimStarted[e]||(n.speedDecelerationRatio[e]=n.speedDecelerationRatio[e]*(n.slowDownRatio[e]+n.slowDownRatioReverse[e]-n.slowDownRatioReverse[e]*n.timeDiff/10),n.speedDecelerationRatioAbs[e]=Math.abs(n.lastFlickSpeed[e]*n.speedDecelerationRatio[e]),n.distanceOffset[e]=n.lastFlickSpeed[e]*n.speedDecelerationRatio[e]*n.timeDiff,_panOffset[e]+=n.distanceOffset[e])},panAnimLoop:function(){return _animations.zoomPan&&(_animations.zoomPan.raf=_requestAF(n.panAnimLoop),n.now=_getCurrentTime(),n.timeDiff=n.now-n.lastNow,n.lastNow=n.now,n.calculateAnimOffset("x"),n.calculateAnimOffset("y"),_applyCurrentZoomPan(),n.calculateOverBoundsAnimOffset("x"),n.calculateOverBoundsAnimOffset("y"),n.speedDecelerationRatioAbs.x<.05&&n.speedDecelerationRatioAbs.y<.05)?(_panOffset.x=Math.round(_panOffset.x),_panOffset.y=Math.round(_panOffset.y),_applyCurrentZoomPan(),void _stopAnimation("zoomPan")):void 0}};return n},_completePanGesture=function(e){return e.calculateSwipeSpeed("y"),_currPanBounds=self.currItem.bounds,e.backAnimDestination={},e.backAnimStarted={},Math.abs(e.lastFlickSpeed.x)<=.05&&Math.abs(e.lastFlickSpeed.y)<=.05?(e.speedDecelerationRatioAbs.x=e.speedDecelerationRatioAbs.y=0,e.calculateOverBoundsAnimOffset("x"),e.calculateOverBoundsAnimOffset("y"),!0):(_registerStartAnimation("zoomPan"),e.lastNow=_getCurrentTime(),void e.panAnimLoop())},_finishSwipeMainScrollGesture=function(e,t){var n;_mainScrollAnimating||(_currZoomedItemIndex=_currentItemIndex);var o;if("swipe"===e){var i=_currPoint.x-_startPoint.x,r=t.lastFlickDist.x<10;i>MIN_SWIPE_DISTANCE&&(r||t.lastFlickOffset.x>20)?o=-1:-MIN_SWIPE_DISTANCE>i&&(r||t.lastFlickOffset.x<-20)&&(o=1)}var a;o&&(_currentItemIndex+=o,_currentItemIndex<0?(_currentItemIndex=_options.loop?_getNumItems()-1:0,a=!0):_currentItemIndex>=_getNumItems()&&(_currentItemIndex=_options.loop?0:_getNumItems()-1,a=!0),(!a||_options.loop)&&(_indexDiff+=o,_currPositionIndex-=o,n=!0));var s,_=_slideSize.x*_currPositionIndex,l=Math.abs(_-_mainScrollPos.x);return n||_>_mainScrollPos.x==t.lastFlickSpeed.x>0?(s=Math.abs(t.lastFlickSpeed.x)>0?l/Math.abs(t.lastFlickSpeed.x):333,s=Math.min(s,400),s=Math.max(s,250)):s=333,_currZoomedItemIndex===_currentItemIndex&&(n=!1),_mainScrollAnimating=!0,_shout("mainScrollAnimStart"),_animateProp("mainScroll",_mainScrollPos.x,_,s,framework.easing.cubic.out,_moveMainScroll,function(){_stopAllAnimations(),_mainScrollAnimating=!1,_currZoomedItemIndex=-1,(n||_currZoomedItemIndex!==_currentItemIndex)&&self.updateCurrItem(),_shout("mainScrollAnimComplete")}),n&&self.updateCurrItem(!0),n},_calculateZoomLevel=function(e){return 1/_startPointsDistance*e*_startZoomLevel},_completeZoomGesture=function(){var e=_currZoomLevel,t=_getMinZoomLevel(),n=_getMaxZoomLevel();_currZoomLevel<t?e=t:_currZoomLevel>n&&(e=n);var o,i=1,r=_bgOpacity;return _opacityChanged&&!_isZoomingIn&&!_wasOverInitialZoom&&_currZoomLevel<t?(self.close(),!0):(_opacityChanged&&(o=function(e){_applyBgOpacity((i-r)*e+r)}),self.zoomTo(e,0,200,framework.easing.cubic.out,o),!0)};_registerModule("Gestures",{publicMethods:{initGestures:function(){var e=function(e,t,n,o,i){_dragStartEvent=e+t,_dragMoveEvent=e+n,_dragEndEvent=e+o,i?_dragCancelEvent=e+i:_dragCancelEvent=""};_pointerEventEnabled=_features.pointerEvent,_pointerEventEnabled&&_features.touch&&(_features.touch=!1),_pointerEventEnabled?navigator.pointerEnabled?e("pointer","down","move","up","cancel"):e("MSPointer","Down","Move","Up","Cancel"):_features.touch?(e("touch","start","move","end","cancel"),_likelyTouchDevice=!0):e("mouse","down","move","up"),_upMoveEvents=_dragMoveEvent+" "+_dragEndEvent+" "+_dragCancelEvent,_downEvents=_dragStartEvent,_pointerEventEnabled&&!_likelyTouchDevice&&(_likelyTouchDevice=navigator.maxTouchPoints>1||navigator.msMaxTouchPoints>1),self.likelyTouchDevice=_likelyTouchDevice,_globalEventHandlers[_dragStartEvent]=_onDragStart,_globalEventHandlers[_dragMoveEvent]=_onDragMove,_globalEventHandlers[_dragEndEvent]=_onDragRelease,_dragCancelEvent&&(_globalEventHandlers[_dragCancelEvent]=_globalEventHandlers[_dragEndEvent]),_features.touch&&(_downEvents+=" mousedown",_upMoveEvents+=" mousemove mouseup",_globalEventHandlers.mousedown=_globalEventHandlers[_dragStartEvent],_globalEventHandlers.mousemove=_globalEventHandlers[_dragMoveEvent],_globalEventHandlers.mouseup=_globalEventHandlers[_dragEndEvent]),_likelyTouchDevice||(_options.allowPanToNext=!1)}}});