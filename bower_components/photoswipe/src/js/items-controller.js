var _items,_tempPanAreaSize={},_imagesToAppendPool=[],_initialContentSet,_initialZoomRunning,_controllerDefaultOptions={index:0,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">The image</a> could not be loaded.</div>',forceProgressiveLoading:!1,preload:[1,1],getNumItemsFn:function(){return _items.length}},_getItemAt,_getNumItems,_initialIsLoop,_getZeroBounds=function(){return{center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}}},_calculateSingleItemPanBounds=function(e,o,n){var t=e.bounds;t.center.x=Math.round((_tempPanAreaSize.x-o)/2),t.center.y=Math.round((_tempPanAreaSize.y-n)/2)+e.vGap.top,t.max.x=o>_tempPanAreaSize.x?Math.round(_tempPanAreaSize.x-o):t.center.x,t.max.y=n>_tempPanAreaSize.y?Math.round(_tempPanAreaSize.y-n)+e.vGap.top:t.center.y,t.min.x=o>_tempPanAreaSize.x?0:t.center.x,t.min.y=n>_tempPanAreaSize.y?e.vGap.top:t.center.y},_calculateItemSize=function(e,o,n){if(e.src&&!e.loadError){var t=!n;if(t&&(e.vGap||(e.vGap={top:0,bottom:0}),_shout("parseVerticalMargin",e)),_tempPanAreaSize.x=o.x,_tempPanAreaSize.y=o.y-e.vGap.top-e.vGap.bottom,t){var i=_tempPanAreaSize.x/e.w,r=_tempPanAreaSize.y/e.h;e.fitRatio=r>i?i:r;var a=_options.scaleMode;"orig"===a?n=1:"fit"===a&&(n=e.fitRatio),n>1&&(n=1),e.initialZoomLevel=n,e.bounds||(e.bounds=_getZeroBounds())}if(!n)return;return _calculateSingleItemPanBounds(e,e.w*n,e.h*n),t&&n===e.initialZoomLevel&&(e.initialPosition=e.bounds.center),e.bounds}return e.w=e.h=0,e.initialZoomLevel=e.fitRatio=1,e.bounds=_getZeroBounds(),e.initialPosition=e.bounds.center,e.bounds},_appendImage=function(e,o,n,t,i,r){o.loadError||t&&(o.imageAppended=!0,_setImageSize(o,t),n.appendChild(t),r&&setTimeout(function(){o&&o.loaded&&o.placeholder&&(o.placeholder.style.display="none",o.placeholder=null)},500))},_preloadImage=function(e){e.loading=!0,e.loaded=!1;var o=e.img=framework.createEl("pswp__img","img"),n=function(){e.loading=!1,e.loaded=!0,e.loadComplete?e.loadComplete(e):e.img=null,o.onload=o.onerror=null,o=null};return o.onload=n,o.onerror=function(){e.loadError=!0,n()},o.src=e.src,o},_checkForError=function(e,o){return e.src&&e.loadError&&e.container?(o&&(e.container.innerHTML=""),e.container.innerHTML=_options.errorMsg.replace("%url%",e.src),!0):void 0},_setImageSize=function(e,o,n){if(e.src){o||(o=e.container.lastChild);var t=n?e.w:Math.round(e.w*e.fitRatio),i=n?e.h:Math.round(e.h*e.fitRatio);e.placeholder&&!e.loaded&&(e.placeholder.style.width=t+"px",e.placeholder.style.height=i+"px"),o.style.width=t+"px",o.style.height=i+"px"}},_appendImagesPool=function(){if(_imagesToAppendPool.length){for(var e,o=0;o<_imagesToAppendPool.length;o++)e=_imagesToAppendPool[o],e.holder.index===e.index&&_appendImage(e.index,e.item,e.baseDiv,e.img,!1,e.clearPlaceholder);_imagesToAppendPool=[]}};_registerModule("Controller",{publicMethods:{lazyLoadItem:function(e){e=_getLoopedId(e);var o=_getItemAt(e);!o||o.loaded||o.loading||(_shout("gettingData",e,o),o.src&&_preloadImage(o))},initController:function(){framework.extend(_options,_controllerDefaultOptions,!0),self.items=_items=items,_getItemAt=self.getItemAt,_getNumItems=_options.getNumItemsFn,_initialIsLoop=_options.loop,_getNumItems()<3&&(_options.loop=!1),_listen("beforeChange",function(e){var o,n=_options.preload,t=null===e?!0:e>0,i=Math.min(n[0],_getNumItems()),r=Math.min(n[1],_getNumItems());for(o=1;(t?r:i)>=o;o++)self.lazyLoadItem(_currentItemIndex+o);for(o=1;(t?i:r)>=o;o++)self.lazyLoadItem(_currentItemIndex-o)}),_listen("initialLayout",function(){self.currItem.initialLayout=_options.getThumbBoundsFn&&_options.getThumbBoundsFn(_currentItemIndex)}),_listen("mainScrollAnimComplete",_appendImagesPool),_listen("initialZoomInEnd",_appendImagesPool),_listen("destroy",function(){for(var e,o=0;o<_items.length;o++)e=_items[o],e.container&&(e.container=null),e.placeholder&&(e.placeholder=null),e.img&&(e.img=null),e.preloader&&(e.preloader=null),e.loadError&&(e.loaded=e.loadError=!1);_imagesToAppendPool=null})},getItemAt:function(e){return e>=0&&void 0!==_items[e]?_items[e]:!1},allowProgressiveImg:function(){return _options.forceProgressiveLoading||!_likelyTouchDevice||_options.mouseUsed||screen.width>1200},setContent:function(e,o){_options.loop&&(o=_getLoopedId(o));var n=self.getItemAt(e.index);n&&(n.container=null);var t,i=self.getItemAt(o);if(!i)return void(e.el.innerHTML="");_shout("gettingData",o,i),e.index=o,e.item=i;var r=i.container=framework.createEl("pswp__zoom-wrap");if(!i.src&&i.html&&(i.html.tagName?r.appendChild(i.html):r.innerHTML=i.html),_checkForError(i),_calculateItemSize(i,_viewportSize),!i.src||i.loadError||i.loaded)i.src&&!i.loadError&&(t=framework.createEl("pswp__img","img"),t.style.opacity=1,t.src=i.src,_setImageSize(i,t),_appendImage(o,i,r,t,!0));else{if(i.loadComplete=function(n){if(_isOpen){if(e&&e.index===o){if(_checkForError(n,!0))return n.loadComplete=n.img=null,_calculateItemSize(n,_viewportSize),_applyZoomPanToItem(n),void(e.index===_currentItemIndex&&self.updateCurrZoomItem());n.imageAppended?!_initialZoomRunning&&n.placeholder&&(n.placeholder.style.display="none",n.placeholder=null):_features.transform&&(_mainScrollAnimating||_initialZoomRunning)?_imagesToAppendPool.push({item:n,baseDiv:r,img:n.img,index:o,holder:e,clearPlaceholder:!0}):_appendImage(o,n,r,n.img,_mainScrollAnimating||_initialZoomRunning,!0)}n.loadComplete=null,n.img=null,_shout("imageLoadComplete",o,n)}},framework.features.transform){var a="pswp__img pswp__img--placeholder";a+=i.msrc?"":" pswp__img--placeholder--blank";var l=framework.createEl(a,i.msrc?"img":"");i.msrc&&(l.src=i.msrc),_setImageSize(i,l),r.appendChild(l),i.placeholder=l}i.loading||_preloadImage(i),self.allowProgressiveImg()&&(!_initialContentSet&&_features.transform?_imagesToAppendPool.push({item:i,baseDiv:r,img:i.img,index:o,holder:e}):_appendImage(o,i,r,i.img,!0,!0))}_initialContentSet||o!==_currentItemIndex?_applyZoomPanToItem(i):(_currZoomElementStyle=r.style,_showOrHide(i,t||i.img)),e.el.innerHTML="",e.el.appendChild(r)},cleanSlide:function(e){e.img&&(e.img.onload=e.img.onerror=null),e.loaded=e.loading=e.img=e.imageAppended=!1}}});