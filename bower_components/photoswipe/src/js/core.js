var self=this,DOUBLE_TAP_RADIUS=25,NUM_HOLDERS=3,_options={allowPanToNext:!0,spacing:.12,bgOpacity:1,mouseUsed:!1,loop:!0,pinchToClose:!0,closeOnScroll:!0,closeOnVerticalDrag:!0,verticalDragRange:.75,hideAnimationDuration:333,showAnimationDuration:333,showHideOpacity:!1,focus:!0,escKey:!0,arrowKeys:!0,mainScrollEndFriction:.35,panEndFriction:.35,isClickableElement:function(e){return"A"===e.tagName},getDoubleTapZoom:function(e,t){return e?1:t.initialZoomLevel<.7?1:1.33},maxSpreadZoom:1.33,modal:!0,scaleMode:"fit",alwaysFadeIn:!1};framework.extend(_options,options);var _getEmptyPoint=function(){return{x:0,y:0}},_isOpen,_isDestroying,_closedByScroll,_currentItemIndex,_containerStyle,_containerShiftIndex,_currPanDist=_getEmptyPoint(),_startPanOffset=_getEmptyPoint(),_panOffset=_getEmptyPoint(),_upMoveEvents,_downEvents,_globalEventHandlers,_viewportSize={},_currZoomLevel,_startZoomLevel,_translatePrefix,_translateSufix,_updateSizeInterval,_itemsNeedUpdate,_currPositionIndex=0,_offset={},_slideSize=_getEmptyPoint(),_itemHolders,_prevItemIndex,_indexDiff=0,_dragStartEvent,_dragMoveEvent,_dragEndEvent,_dragCancelEvent,_transformKey,_pointerEventEnabled,_isFixedPosition=!0,_likelyTouchDevice,_modules=[],_requestAF,_cancelAF,_initalClassName,_initalWindowScrollY,_oldIE,_currentWindowScrollY,_features,_windowVisibleSize={},_renderMaxResolution=!1,_registerModule=function(e,t){framework.extend(self,t.publicMethods),_modules.push(e)},_getLoopedId=function(e){var t=_getNumItems();return e>t-1?e-t:0>e?t+e:e},_listeners={},_listen=function(e,t){return _listeners[e]||(_listeners[e]=[]),_listeners[e].push(t)},_shout=function(e){var t=_listeners[e];if(t){var n=Array.prototype.slice.call(arguments);n.shift();for(var o=0;o<t.length;o++)t[o].apply(self,n)}},_getCurrentTime=function(){return(new Date).getTime()},_applyBgOpacity=function(e){_bgOpacity=e,self.bg.style.opacity=e*_options.bgOpacity},_applyZoomTransform=function(e,t,n,o,i){(!_renderMaxResolution||i&&i!==self.currItem)&&(o/=i?i.fitRatio:self.currItem.fitRatio),e[_transformKey]=_translatePrefix+t+"px, "+n+"px"+_translateSufix+" scale("+o+")"},_applyCurrentZoomPan=function(e){_currZoomElementStyle&&(e&&(_currZoomLevel>self.currItem.fitRatio?_renderMaxResolution||(_setImageSize(self.currItem,!1,!0),_renderMaxResolution=!0):_renderMaxResolution&&(_setImageSize(self.currItem),_renderMaxResolution=!1)),_applyZoomTransform(_currZoomElementStyle,_panOffset.x,_panOffset.y,_currZoomLevel))},_applyZoomPanToItem=function(e){e.container&&_applyZoomTransform(e.container.style,e.initialPosition.x,e.initialPosition.y,e.initialZoomLevel,e)},_setTranslateX=function(e,t){t[_transformKey]=_translatePrefix+e+"px, 0px"+_translateSufix},_moveMainScroll=function(e,t){if(!_options.loop&&t){var n=_currentItemIndex+(_slideSize.x*_currPositionIndex-e)/_slideSize.x,o=Math.round(e-_mainScrollPos.x);(0>n&&o>0||n>=_getNumItems()-1&&0>o)&&(e=_mainScrollPos.x+o*_options.mainScrollEndFriction)}_mainScrollPos.x=e,_setTranslateX(e,_containerStyle)},_calculatePanOffset=function(e,t){var n=_midZoomPoint[e]-_offset[e];return _startPanOffset[e]+_currPanDist[e]+n-n*(t/_startZoomLevel)},_equalizePoints=function(e,t){e.x=t.x,e.y=t.y,t.id&&(e.id=t.id)},_roundPoint=function(e){e.x=Math.round(e.x),e.y=Math.round(e.y)},_mouseMoveTimeout=null,_onFirstMouseMove=function(){_mouseMoveTimeout&&(framework.unbind(document,"mousemove",_onFirstMouseMove),framework.addClass(template,"pswp--has_mouse"),_options.mouseUsed=!0,_shout("mouseUsed")),_mouseMoveTimeout=setTimeout(function(){_mouseMoveTimeout=null},100)},_bindEvents=function(){framework.bind(document,"keydown",self),_features.transform&&framework.bind(self.scrollWrap,"click",self),_options.mouseUsed||framework.bind(document,"mousemove",_onFirstMouseMove),framework.bind(window,"resize scroll",self),_shout("bindEvents")},_unbindEvents=function(){framework.unbind(window,"resize",self),framework.unbind(window,"scroll",_globalEventHandlers.scroll),framework.unbind(document,"keydown",self),framework.unbind(document,"mousemove",_onFirstMouseMove),_features.transform&&framework.unbind(self.scrollWrap,"click",self),_isDragging&&framework.unbind(window,_upMoveEvents,self),_shout("unbindEvents")},_calculatePanBounds=function(e,t){var n=_calculateItemSize(self.currItem,_viewportSize,e);return t&&(_currPanBounds=n),n},_getMinZoomLevel=function(e){return e||(e=self.currItem),e.initialZoomLevel},_getMaxZoomLevel=function(e){return e||(e=self.currItem),e.w>0?_options.maxSpreadZoom:1},_modifyDestPanOffset=function(e,t,n,o){return o===self.currItem.initialZoomLevel?(n[e]=self.currItem.initialPosition[e],!0):(n[e]=_calculatePanOffset(e,o),n[e]>t.min[e]?(n[e]=t.min[e],!0):n[e]<t.max[e]?(n[e]=t.max[e],!0):!1)},_setupTransforms=function(){if(_transformKey){var e=_features.perspective&&!_likelyTouchDevice;return _translatePrefix="translate"+(e?"3d(":"("),void(_translateSufix=_features.perspective?", 0px)":")")}_transformKey="left",framework.addClass(template,"pswp--ie"),_setTranslateX=function(e,t){t.left=e+"px"},_applyZoomPanToItem=function(e){var t=e.fitRatio>1?1:e.fitRatio,n=e.container.style,o=t*e.w,i=t*e.h;n.width=o+"px",n.height=i+"px",n.left=e.initialPosition.x+"px",n.top=e.initialPosition.y+"px"},_applyCurrentZoomPan=function(){if(_currZoomElementStyle){var e=_currZoomElementStyle,t=self.currItem,n=t.fitRatio>1?1:t.fitRatio,o=n*t.w,i=n*t.h;e.width=o+"px",e.height=i+"px",e.left=_panOffset.x+"px",e.top=_panOffset.y+"px"}}},_onKeyDown=function(e){var t="";_options.escKey&&27===e.keyCode?t="close":_options.arrowKeys&&(37===e.keyCode?t="prev":39===e.keyCode&&(t="next")),t&&(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||(e.preventDefault?e.preventDefault():e.returnValue=!1,self[t]()))},_onGlobalClick=function(e){e&&(_moved||_zoomStarted||_mainScrollAnimating||_verticalDragInitiated)&&(e.preventDefault(),e.stopPropagation())},_updatePageScrollOffset=function(){self.setScrollOffset(0,framework.getScrollY())},_animations={},_numAnimations=0,_stopAnimation=function(e){_animations[e]&&(_animations[e].raf&&_cancelAF(_animations[e].raf),_numAnimations--,delete _animations[e])},_registerStartAnimation=function(e){_animations[e]&&_stopAnimation(e),_animations[e]||(_numAnimations++,_animations[e]={})},_stopAllAnimations=function(){for(var e in _animations)_animations.hasOwnProperty(e)&&_stopAnimation(e)},_animateProp=function(e,t,n,o,i,r,s){var a,l=_getCurrentTime();_registerStartAnimation(e);var _=function(){if(_animations[e]){if(a=_getCurrentTime()-l,a>=o)return _stopAnimation(e),r(n),void(s&&s());r((n-t)*i(a/o)+t),_animations[e].raf=_requestAF(_)}};_()},publicMethods={shout:_shout,listen:_listen,viewportSize:_viewportSize,options:_options,isMainScrollAnimating:function(){return _mainScrollAnimating},getZoomLevel:function(){return _currZoomLevel},getCurrentIndex:function(){return _currentItemIndex},isDragging:function(){return _isDragging},isZooming:function(){return _isZooming},setScrollOffset:function(e,t){_offset.x=e,_currentWindowScrollY=_offset.y=t,_shout("updateScrollOffset",_offset)},applyZoomPan:function(e,t,n,o){_panOffset.x=t,_panOffset.y=n,_currZoomLevel=e,_applyCurrentZoomPan(o)},init:function(){if(!_isOpen&&!_isDestroying){var e;self.framework=framework,self.template=template,self.bg=framework.getChildByClass(template,"pswp__bg"),_initalClassName=template.className,_isOpen=!0,_features=framework.detectFeatures(),_requestAF=_features.raf,_cancelAF=_features.caf,_transformKey=_features.transform,_oldIE=_features.oldIE,self.scrollWrap=framework.getChildByClass(template,"pswp__scroll-wrap"),self.container=framework.getChildByClass(self.scrollWrap,"pswp__container"),_containerStyle=self.container.style,self.itemHolders=_itemHolders=[{el:self.container.children[0],wrap:0,index:-1},{el:self.container.children[1],wrap:0,index:-1},{el:self.container.children[2],wrap:0,index:-1}],_itemHolders[0].el.style.display=_itemHolders[2].el.style.display="none",_setupTransforms(),_globalEventHandlers={resize:self.updateSize,scroll:_updatePageScrollOffset,keydown:_onKeyDown,click:_onGlobalClick};var t=_features.isOldIOSPhone||_features.isOldAndroid||_features.isMobileOpera;for(_features.animationName&&_features.transform&&!t||(_options.showAnimationDuration=_options.hideAnimationDuration=0),e=0;e<_modules.length;e++)self["init"+_modules[e]]();if(UiClass){var n=self.ui=new UiClass(self,framework);n.init()}_shout("firstUpdate"),_currentItemIndex=_currentItemIndex||_options.index||0,(isNaN(_currentItemIndex)||0>_currentItemIndex||_currentItemIndex>=_getNumItems())&&(_currentItemIndex=0),self.currItem=_getItemAt(_currentItemIndex),(_features.isOldIOSPhone||_features.isOldAndroid)&&(_isFixedPosition=!1),template.setAttribute("aria-hidden","false"),_options.modal&&(_isFixedPosition?template.style.position="fixed":(template.style.position="absolute",template.style.top=framework.getScrollY()+"px")),void 0===_currentWindowScrollY&&(_shout("initialLayout"),_currentWindowScrollY=_initalWindowScrollY=framework.getScrollY());var o="pswp--open ";for(_options.mainClass&&(o+=_options.mainClass+" "),_options.showHideOpacity&&(o+="pswp--animate_opacity "),o+=_likelyTouchDevice?"pswp--touch":"pswp--notouch",o+=_features.animationName?" pswp--css_animation":"",o+=_features.svg?" pswp--svg":"",framework.addClass(template,o),self.updateSize(),_containerShiftIndex=-1,_indexDiff=null,e=0;NUM_HOLDERS>e;e++)_setTranslateX((e+_containerShiftIndex)*_slideSize.x,_itemHolders[e].el.style);_oldIE||framework.bind(self.scrollWrap,_downEvents,self),_listen("initialZoomInEnd",function(){self.setContent(_itemHolders[0],_currentItemIndex-1),self.setContent(_itemHolders[2],_currentItemIndex+1),_itemHolders[0].el.style.display=_itemHolders[2].el.style.display="block",_options.focus&&template.focus(),_bindEvents()}),self.setContent(_itemHolders[1],_currentItemIndex),self.updateCurrItem(),_shout("afterInit"),_isFixedPosition||(_updateSizeInterval=setInterval(function(){_numAnimations||_isDragging||_isZooming||_currZoomLevel!==self.currItem.initialZoomLevel||self.updateSize()},1e3)),framework.addClass(template,"pswp--visible")}},close:function(){_isOpen&&(_isOpen=!1,_isDestroying=!0,_shout("close"),_unbindEvents(),_showOrHide(self.currItem,null,!0,self.destroy))},destroy:function(){_shout("destroy"),_showOrHideTimeout&&clearTimeout(_showOrHideTimeout),template.setAttribute("aria-hidden","true"),template.className=_initalClassName,_updateSizeInterval&&clearInterval(_updateSizeInterval),framework.unbind(self.scrollWrap,_downEvents,self),framework.unbind(window,"scroll",self),_stopDragUpdateLoop(),_stopAllAnimations(),_listeners=null},panTo:function(e,t,n){n||(e>_currPanBounds.min.x?e=_currPanBounds.min.x:e<_currPanBounds.max.x&&(e=_currPanBounds.max.x),t>_currPanBounds.min.y?t=_currPanBounds.min.y:t<_currPanBounds.max.y&&(t=_currPanBounds.max.y)),_panOffset.x=e,_panOffset.y=t,_applyCurrentZoomPan()},handleEvent:function(e){e=e||window.event,_globalEventHandlers[e.type]&&_globalEventHandlers[e.type](e)},goTo:function(e){e=_getLoopedId(e);var t=e-_currentItemIndex;_indexDiff=t,_currentItemIndex=e,self.currItem=_getItemAt(_currentItemIndex),_currPositionIndex-=t,_moveMainScroll(_slideSize.x*_currPositionIndex),_stopAllAnimations(),_mainScrollAnimating=!1,self.updateCurrItem()},next:function(){self.goTo(_currentItemIndex+1)},prev:function(){self.goTo(_currentItemIndex-1)},updateCurrZoomItem:function(e){if(e&&_shout("beforeChange",0),_itemHolders[1].el.children.length){var t=_itemHolders[1].el.children[0];framework.hasClass(t,"pswp__zoom-wrap")?_currZoomElementStyle=t.style:_currZoomElementStyle=null}else _currZoomElementStyle=null;_currPanBounds=self.currItem.bounds,_startZoomLevel=_currZoomLevel=self.currItem.initialZoomLevel,_panOffset.x=_currPanBounds.center.x,_panOffset.y=_currPanBounds.center.y,e&&_shout("afterChange")},invalidateCurrItems:function(){_itemsNeedUpdate=!0;for(var e=0;NUM_HOLDERS>e;e++)_itemHolders[e].item&&(_itemHolders[e].item.needsUpdate=!0)},updateCurrItem:function(e){if(0!==_indexDiff){var t,n=Math.abs(_indexDiff);if(!(e&&2>n)){self.currItem=_getItemAt(_currentItemIndex),_renderMaxResolution=!1,_shout("beforeChange",_indexDiff),n>=NUM_HOLDERS&&(_containerShiftIndex+=_indexDiff+(_indexDiff>0?-NUM_HOLDERS:NUM_HOLDERS),n=NUM_HOLDERS);for(var o=0;n>o;o++)_indexDiff>0?(t=_itemHolders.shift(),_itemHolders[NUM_HOLDERS-1]=t,_containerShiftIndex++,_setTranslateX((_containerShiftIndex+2)*_slideSize.x,t.el.style),self.setContent(t,_currentItemIndex-n+o+1+1)):(t=_itemHolders.pop(),_itemHolders.unshift(t),_containerShiftIndex--,_setTranslateX(_containerShiftIndex*_slideSize.x,t.el.style),self.setContent(t,_currentItemIndex+n-o-1-1));if(_currZoomElementStyle&&1===Math.abs(_indexDiff)){var i=_getItemAt(_prevItemIndex);i.initialZoomLevel!==_currZoomLevel&&(_calculateItemSize(i,_viewportSize),_setImageSize(i),_applyZoomPanToItem(i))}_indexDiff=0,self.updateCurrZoomItem(),_prevItemIndex=_currentItemIndex,_shout("afterChange")}}},updateSize:function(e){if(!_isFixedPosition&&_options.modal){var t=framework.getScrollY();if(_currentWindowScrollY!==t&&(template.style.top=t+"px",_currentWindowScrollY=t),!e&&_windowVisibleSize.x===window.innerWidth&&_windowVisibleSize.y===window.innerHeight)return;_windowVisibleSize.x=window.innerWidth,_windowVisibleSize.y=window.innerHeight,template.style.height=_windowVisibleSize.y+"px"}if(_viewportSize.x=self.scrollWrap.clientWidth,_viewportSize.y=self.scrollWrap.clientHeight,_updatePageScrollOffset(),_slideSize.x=_viewportSize.x+Math.round(_viewportSize.x*_options.spacing),_slideSize.y=_viewportSize.y,_moveMainScroll(_slideSize.x*_currPositionIndex),_shout("beforeResize"),void 0!==_containerShiftIndex){for(var n,o,i,r=0;NUM_HOLDERS>r;r++)n=_itemHolders[r],_setTranslateX((r+_containerShiftIndex)*_slideSize.x,n.el.style),i=_currentItemIndex+r-1,_options.loop&&_getNumItems()>2&&(i=_getLoopedId(i)),o=_getItemAt(i),o&&(_itemsNeedUpdate||o.needsUpdate||!o.bounds)?(self.cleanSlide(o),self.setContent(n,i),1===r&&(self.currItem=o,self.updateCurrZoomItem(!0)),o.needsUpdate=!1):-1===n.index&&i>=0&&self.setContent(n,i),o&&o.container&&(_calculateItemSize(o,_viewportSize),_setImageSize(o),_applyZoomPanToItem(o));_itemsNeedUpdate=!1}_startZoomLevel=_currZoomLevel=self.currItem.initialZoomLevel,_currPanBounds=self.currItem.bounds,_currPanBounds&&(_panOffset.x=_currPanBounds.center.x,_panOffset.y=_currPanBounds.center.y,_applyCurrentZoomPan(!0)),_shout("resize")},zoomTo:function(e,t,n,o,i){t&&(_startZoomLevel=_currZoomLevel,_midZoomPoint.x=Math.abs(t.x)-_panOffset.x,_midZoomPoint.y=Math.abs(t.y)-_panOffset.y,_equalizePoints(_startPanOffset,_panOffset));var r=_calculatePanBounds(e,!1),s={};_modifyDestPanOffset("x",r,s,e),_modifyDestPanOffset("y",r,s,e);var a=_currZoomLevel,l={x:_panOffset.x,y:_panOffset.y};_roundPoint(s);var _=function(t){1===t?(_currZoomLevel=e,_panOffset.x=s.x,_panOffset.y=s.y):(_currZoomLevel=(e-a)*t+a,_panOffset.x=(s.x-l.x)*t+l.x,_panOffset.y=(s.y-l.y)*t+l.y),i&&i(t),_applyCurrentZoomPan(1===t)};n?_animateProp("customZoomTo",0,1,n,o||framework.easing.sine.inOut,_):_(1)}};