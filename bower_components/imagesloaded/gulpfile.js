function rjsOptimize(e){e=e||{},requirejs.define("node/print",[],function(){return function(e){"Error"===e.substring(0,5)?gutil.log(chalk.red(e)):gutil.log(e)}});var i=through.obj(function(r,n,t){return r.isNull()?t(null,r):(e.logLevel=2,e.out=function(e){var i=new gutil.File({path:r.relative,contents:new Buffer(e)});t(null,i)},gutil.log("RequireJS optimizing"),void requirejs.optimize(e,null,function(e){var r=new gutil.PluginError("requirejsOptimize",e.message);i.emit("error",r)}))});return i}function getBanner(){var e=fs.readFileSync("imagesloaded.js","utf8"),i=e.match(reBannerComment),r=i[0].replace("imagesLoaded","imagesLoaded PACKAGED");return r}function addBanner(e){return replace(/^/,e)}var fs=require("fs"),gulp=require("gulp"),rename=require("gulp-rename"),replace=require("gulp-replace"),jshint=require("gulp-jshint");gulp.task("hint-js",function(){return gulp.src("imagesloaded.js").pipe(jshint()).pipe(jshint.reporter("default"))}),gulp.task("hint-test",function(){return gulp.src("test/unit/*.js").pipe(jshint()).pipe(jshint.reporter("default"))}),gulp.task("hint-task",function(){return gulp.src("gulpfile.js").pipe(jshint()).pipe(jshint.reporter("default"))});var jsonlint=require("gulp-json-lint");gulp.task("jsonlint",function(){return gulp.src("*.json").pipe(jsonlint()).pipe(jsonlint.report("verbose"))}),gulp.task("hint",["hint-js","hint-test","hint-task","jsonlint"]);var gutil=require("gulp-util"),through=require("through2"),requirejs=require("requirejs"),chalk=require("chalk"),reBannerComment=new RegExp("^\\s*(?:\\/\\*[\\s\\S]*?\\*\\/)\\s*");gulp.task("requirejs",function(){var e=getBanner();return gulp.src("imagesloaded.js").pipe(rjsOptimize({baseUrl:"bower_components",optimize:"none",include:["../imagesloaded"]})).pipe(replace("'../imagesloaded',","")).pipe(addBanner(e)).pipe(rename("imagesloaded.pkgd.js")).pipe(gulp.dest("."))});var uglify=require("gulp-uglify");gulp.task("uglify",["requirejs"],function(){var e=getBanner();gulp.src("imagesloaded.pkgd.js").pipe(uglify()).pipe(addBanner(e)).pipe(rename("imagesloaded.pkgd.min.js")).pipe(gulp.dest("."))});var minimist=require("minimist");gulp.task("version",function(){var e=minimist(process.argv.slice(3)),i=e.t;return i&&/\d\.\d\.\d/.test(i)?(gutil.log("ticking version to "+chalk.green(i)),gulp.src("imagesloaded.js").pipe(replace(/imagesLoaded v\d\.\d\.\d/,"imagesLoaded v"+i)).pipe(gulp.dest(".")),gulp.src(["bower.json","package.json"]).pipe(replace(/"version": "\d\.\d\.\d"/,'"version": "'+i+'"')).pipe(gulp.dest(".")),void gulp.src("README.md").pipe(replace(/ajax\/libs\/jquery.imagesloaded\/\d\.\d\.\d/g,"ajax/libs/jquery.imagesloaded/"+i)).pipe(gulp.dest("."))):void gutil.log("invalid version: "+chalk.red(i))}),gulp.task("default",["hint","uglify"]);